{% extends "base.html" %}

{% block title %}Dashboard - Flask AI Habit Predictor{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
        <h2 class="text-2xl font-bold mb-4">Today's Habit Risks</h2>
        <ul class="space-y-2">
            {% for item in risks %}
            <li class="bg-white p-4 rounded-lg shadow">
                <div class="flex justify-between items-center">
                    <span>{{ item.habit.name }}</span>
                    <span class="text-red-600 font-bold">{{ "%.1f"|format(item.risk * 100) }}% risk</span>
                </div>
            </li>
            {% endfor %}
        </ul>
        <h3 class="text-xl font-bold mt-6 mb-4">Add Custom Habit</h3>
        <form action="{{ url_for('add_habit') }}" method="post" class="bg-white p-4 rounded-lg shadow">
            <div class="mb-4">
                <label for="name" class="block text-sm font-medium text-gray-700">Habit Name</label>
                <input type="text" id="name" name="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div class="mb-4">
                <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
                <select id="category" name="category" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="water">Water</option>
                    <option value="exercise">Exercise</option>
                    <option value="reading">Reading</option>
                    <option value="mindfulness">Mindfulness</option>
                    <option value="writing">Writing</option>
                    <option value="nutrition">Nutrition</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Add Habit</button>
        </form>
        <a href="{{ url_for('retrain') }}" class="mt-4 inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Retrain Model</a>
    </div>
    <div>
        <h2 class="text-2xl font-bold mb-4">Personalized Nudge</h2>
        {% if top_nudge %}
        <div class="bg-yellow-100 p-4 rounded-lg">
            <p>Do your <strong>{{ top_nudge.habit.name }}</strong> now, {{ "%.1f"|format(top_nudge.risk * 100) }}% skip risk!</p>
        </div>
        {% endif %}
        <h3 class="text-xl font-bold mt-6 mb-4">Habit Streaks</h3>
        <canvas id="streakChart" width="400" height="200"></canvas>
    </div>
</div>

<script>
    // Sample data for chart, replace with real data
    const ctx = document.getElementById('streakChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5'],
            datasets: [{
                label: 'Completion Rate',
                data: [80, 90, 70, 85, 95],
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        }
    });
</script>
{% endblock %}